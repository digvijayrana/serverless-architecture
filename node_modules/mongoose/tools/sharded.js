'use strict';

run().catch(error => {
  console.error(error);
  process.exit(-1);
});


async function run() {
  const Sharded = require('mongodb-topology-manager').Sharded;

  // Create new instance
  const topology = new Sharded({
    mongod: 'mongod',
    mongos: 'mongos'
  });

  await topology.addShard([{
    options: {
<<<<<<< HEAD
      bind_ip: '127.0.0.1', port: 31000, dbpath: '/data/db/31000', shardsvr: null
=======
      bind_ip: 'localhost', port: 31000, dbpath: '/data/db/31000', shardsvr: null
>>>>>>> fd4215aa5028bc75f532153c8e97a44d89c0c47d
    }
  }], { replSet: 'rs1' });

  await topology.addConfigurationServers([{
    options: {
<<<<<<< HEAD
      bind_ip: '127.0.0.1', port: 35000, dbpath: '/data/db/35000'
=======
      bind_ip: 'localhost', port: 35000, dbpath: '/data/db/35000'
>>>>>>> fd4215aa5028bc75f532153c8e97a44d89c0c47d
    }
  }], { replSet: 'rs0' });

  await topology.addProxies([{
<<<<<<< HEAD
    bind_ip: '127.0.0.1', port: 51000, configdb: '127.0.0.1:35000'
=======
    bind_ip: 'localhost', port: 51000, configdb: 'localhost:35000'
>>>>>>> fd4215aa5028bc75f532153c8e97a44d89c0c47d
  }], {
    binary: 'mongos'
  });

  console.log('Start...');
  // Start up topology
  await topology.start();

  console.log('Started');

  // Shard db
  await topology.enableSharding('test');

  console.log('done');
<<<<<<< HEAD
}
=======
}
>>>>>>> fd4215aa5028bc75f532153c8e97a44d89c0c47d
