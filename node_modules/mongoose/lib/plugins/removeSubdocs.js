'use strict';

const each = require('../helpers/each');

/*!
 * ignore
 */

<<<<<<< HEAD
module.exports = function removeSubdocs(schema) {
  const unshift = true;
  schema.s.hooks.pre('deleteOne', { document: true, query: false }, function removeSubDocsPreRemove(next) {
=======
module.exports = function(schema) {
  const unshift = true;
  schema.s.hooks.pre('remove', false, function(next) {
>>>>>>> fd4215aa5028bc75f532153c8e97a44d89c0c47d
    if (this.$isSubdocument) {
      next();
      return;
    }
<<<<<<< HEAD
    if (this.$__ == null) {
      next();
      return;
    }
=======
>>>>>>> fd4215aa5028bc75f532153c8e97a44d89c0c47d

    const _this = this;
    const subdocs = this.$getAllSubdocs();

    each(subdocs, function(subdoc, cb) {
<<<<<<< HEAD
      subdoc.$__deleteOne(cb);
    }, function(error) {
      if (error) {
        return _this.$__schema.s.hooks.execPost('deleteOne:error', _this, [_this], { error: error }, function(error) {
=======
      subdoc.$__remove(cb);
    }, function(error) {
      if (error) {
        return _this.$__schema.s.hooks.execPost('remove:error', _this, [_this], { error: error }, function(error) {
>>>>>>> fd4215aa5028bc75f532153c8e97a44d89c0c47d
          next(error);
        });
      }
      next();
    });
  }, null, unshift);
};
